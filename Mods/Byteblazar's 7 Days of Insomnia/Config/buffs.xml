<Byteblazar>
	<append xpath="/buffs">
	
	<!-- ###################################################################################################
			Hidden tracker of hours awake (sleep need implementation)
			- from 24 to 48 (random) hours without sleep, applies a -10% XP gain debuff
			  chance of microsleep
			- from 48 to 72 hours without sleep, replaces base debuff with a -20% XP gain debuff
			  chance of hallucinations
		 ################################################################################################### -->
		<buff name="bb7doi_buffTracker" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
			<effect_group name="startup">
				<!-- default 24-hour cycle: 60 minutes. Timescale = 60 -->
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyCVar" cvar=".bb7doiTS" operation="set" value="60"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiTS" operation="set" value="60"/>
				<!-- ingame time: 1 hour IRL = 24 hours ingame, so the ratio is 24 to 1 -->
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="set" value="60"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="divide" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="multiply" value="24"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="set" value="60"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="divide" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiTSRatio" operation="multiply" value="24"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiTS" operation="NotEquals" value="@$bb7doiOldTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiOldTS" operation="set" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiDeprivationStart" operation="set" value="randomint(60,70)"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiDeprivationStart" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiDeprivation2Start" operation="set" value="randomint(120,180)"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiDeprivation2Start" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi7daysAwake" operation="set" value="420"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi7daysAwake" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi8hoursAdjusted" operation="set" value="20"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi8hoursAdjusted" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi16hoursAdjusted" operation="set" value="40"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi16hoursAdjusted" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi20hoursAdjusted" operation="set" value="50"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi20hoursAdjusted" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi1dayAdjusted" operation="set" value="60"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi1dayAdjusted" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi2daysAdjusted" operation="set" value="120"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi2daysAdjusted" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi4daysAdjusted" operation="set" value="240"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doi4daysAdjusted" operation="multiply" value="@.bb7doiTS"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffInsomniaChanceTracker">
					<requirement name="!HasBuff" buff="bb7doi_buffInsomniaChanceTracker"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiTrackerCounter" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDeprivationStart" operation="set" value="randomint(60,70)"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDeprivationStart" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDeprivation2Start" operation="set" value="randomint(120,180)"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDeprivation2Start" operation="multiply" value="@.bb7doiTS"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiTrackerCounter" operation="add" value="1">
					<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiTrackerInGameSeconds" operation="set" value="@$bb7doiTrackerCounter"/>
				<!-- <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiTrackerInGameSeconds" operation="divide" value="3600"/> -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiTrackerInGameSeconds" operation="multiply" value="@.bb7doiTSRatio"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDummy7daysAwake">
					<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="GTE" value="@$bb7doi7daysAwake"/>
					<requirement name="!HasBuff" buff="bb7doi_buffDummy7daysAwake"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffBedtime">
					<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="Equals" value="@$bb7doi20hoursAdjusted"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDeprivation">
					<requirement name="!HasBuff" buff="bb7doi_buffDeprivation"/>
					<requirement name="!HasBuff" buff="bb7doi_buffDeprivation2"/>
					<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="GTE" value="@$bb7doiDeprivationStart"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDeprivation2">
					<requirement name="!HasBuff" buff="bb7doi_buffDeprivation2"/>
					<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="GTE" value="@$bb7doiDeprivation2Start"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationSFXchanceMod" operation="set" value="@$bb7doiTrackerCounter"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchanceMod" operation="set" value="@$bb7doiTrackerCounter"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationSFXchanceMod" operation="divide" value="@$bb7doi4daysAdjusted"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchanceMod" operation="divide" value="@$bb7doi2daysAdjusted"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationSFXchance" operation="set" value=".5"/> <!-- base chance every second -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationSFXchance" operation="add" value="@.bb7doiDeprivationSFXchanceMod"/> <!-- +.25/ingame day -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchance" operation="set" value="2"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchance" operation="add" value="@.bb7doiDeprivationVFXchanceMod"/> <!-- +.5/ingame day -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchance" operation="add" value="1">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationVFXchance" operation="add" value="2">
					<requirement name="HasBuff" buff="bb7doi_buffSedative"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiDeprivationFXroll" operation="set" value="randomfloat(0,100)"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDeprivation2SFX">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS1"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivationFXroll" operation="LTE" value="@.bb7doiDeprivationSFXchance"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDeprivationVFX">
					<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="GTE" value="@$bb7doiDeprivationStart"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS1"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivationFXroll" operation="GT" value="@.bb7doiDeprivationSFXchance"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivationFXroll" operation="LTE" value="@.bb7doiDeprivationVFXchance"/>
				</triggered_effect>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="LT" value="@$bb7doiDeprivationStart"/>
				<requirement name="!HasBuff" buff="bb7doi_buffS1"/>
				<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulant"/>
				<requirement name="!HasBuff" buff="bb7doi_buffWakefulness"/>
				<requirement name="HasBuff" buff="bb7doi_buffSedative"/>
				<requirement name="CVarCompare" cvar=".bb7doiDeprivationFXroll" operation="GT" value="@.bb7doiDeprivationSFXchance"/>
				<requirement name="CVarCompare" cvar=".bb7doiDeprivationFXroll" operation="LTE" value="@.bb7doiDeprivationVFXchance"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffDeprivationVFX"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffSedative2Blinking"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfDied" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="set" value="0"/>
				<!-- <triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffWakefulness"/> -->
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDeprivationVFX"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDeprivation2SFX"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDeprivation2"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDeprivation"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffBedtime"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDummy7daysAwake"/>
			</effect_group>
		</buff>
		
		<!-- buff used for challenges -->
		<buff name="bb7doi_buffDummy7daysAwake" name_key="7DayLongDeprivation" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
		</buff>
		
		<!-- Reminder at 20 hours awake -->
		<buff name="bb7doi_buffBedtime" name_key="Bedtime" description_key="BedtimeDesc" tooltip_key="BedtimeTooltip" icon="ui_game_symbol_map_bed" icon_color="160,202,202" remove_on_death="true">
			<stack_type value="ignore"/>
			<display_value value=".bb7doiTrackerInGameSeconds"/>
			<display_value_format value="time"/>
			<duration value="0"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffBedtimeBlinking"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffWakefulness"/>
				<!-- for testing from the console -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiTrackerCounter" operation="set" value="@$bb7doi20hoursAdjusted"/>
			</effect_group>
			<effect_group>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<requirement name="!HasBuff" buff="buffCoffee"/>
				<requirement name="!HasBuff" buff="buffBlackStrapCoffee"/>
				<requirement name="!HasBuff" buff="buffMegaCrush"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDeprivationVFX"/>
			</effect_group>
		</buff>
		
		<buff name="bb7doi_buffBedtimeBlinking" hidden="true">
			<stack_type value="ignore"/>
			<duration value="3"/>
			<effect_group>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bb7doi_buffBedtime"/>
			</effect_group>
		</buff>

			<!-- Deprivation 1 debuff (reduces XP gain by 10%) -->
		<buff name="bb7doi_buffDeprivation" name_key="SleepDeprivation" description_key="SleepDeprivationDesc" tooltip_key="SleepDeprivationTooltip" icon="ui_game_symbol_fatigued"  icon_color="100,150,170"  remove_on_death="true">
			<stack_type value="ignore"/>
			<display_value value=".bb7doiTrackerInGameSeconds"/>
			<display_value_format value="time"/>
			<duration value="0"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDeprivationBlinking"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDummyDeprivation"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDummyDeprivation"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffBedtime"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="add" value="10"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffWakefulness"/>
				<passive_effect name="PlayerExpGain" operation="perc_add" value="-.1">
					<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				</passive_effect>
				<!-- for testing from the console -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiTrackerCounter" operation="set" value="@$bb7doiDeprivationStart"/>
			</effect_group>
		</buff>
		
		<buff name="bb7doi_buffDeprivationBlinking" hidden="true">
			<stack_type value="ignore"/>
			<duration value="3"/>
			<effect_group>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bb7doi_buffDeprivation"/>
			</effect_group>
		</buff>

		<!-- buff used for challenges -->
		<buff name="bb7doi_buffDummyDeprivation" name_key="SleepDeprivationSymptoms" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
		</buff>
		
			<!-- Deprivation 2 debuffs (reduces XP gain by 20%) -->
		<buff name="bb7doi_buffDeprivation2" name_key="SevereSleepDeprivation" description_key="SevereSleepDeprivationDesc" tooltip_key="SevereSleepDeprivationTooltip" icon="ui_game_symbol_fatigued" icon_color="150,100,170" remove_on_death="true">
			<stack_type value="ignore"/>
			<display_value value=".bb7doiTrackerInGameSeconds"/>
			<display_value_format value="time"/>
			<duration value="0"/>
			<effect_group>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" effect_name="Radiation" intensity="1" fade="1"/> -->
				<!-- <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" effect_name="Radiation" intensity="0" fade="1"/> -->
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDeprivation2Blinking"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDummyDeprivation2"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDummyDeprivation2"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity=".2" fade="1" effect_name="Greyscale"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".2" fade="1" effect_name="Greyscale"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Greyscale"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity=".1" fade="1" effect_name="Infected"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".1" fade="1" effect_name="Infected"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Infected"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffBedtime"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffDeprivation"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="add" value="20"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".1" effect_name="Trippy"/>
				<passive_effect name="PlayerExpGain" operation="perc_add" value="-.2">
					<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				</passive_effect>
				<!-- for testing from the console -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiTrackerCounter" operation="set" value="@$bb7doiDeprivation2Start"/>
			</effect_group>
			<effect_group>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity=".1" fade="60" effect_name="Trippy"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".1" fade="60" effect_name="Trippy"/>
			</effect_group>
		</buff>
		<buff name="bb7doi_buffDeprivation2Blinking" hidden="true">
			<stack_type value="ignore"/>
			<duration value="3"/>
			<effect_group>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bb7doi_buffDeprivation2"/>
			</effect_group>
		</buff>

		<!-- buff used for challenges -->
		<buff name="bb7doi_buffDummyDeprivation2" name_key="SevereSleepDeprivationSymptoms" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
		</buff>
		
			<!-- Deprivation 2 sound FX (auditory hallucinations) -->
		<buff name="bb7doi_buffDeprivation2SFX" hidden="true" remove_on_death="true">
			<stack_type value="effect"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiDeprivation2SFXroll" operation="set" value="randomint(0,100)"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiefemalescoutalert" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="90"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiefemalescoutsense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="80"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="90"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiefemalescoutroam" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="70"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="80"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiemale2sense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="60"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="70"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiedogsense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="50"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="60"/>
				</triggered_effect>
			</effect_group>
			<effect_group>
			<!-- indoor hallucinations -->
				<requirement name="IsIndoors"/>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_glassdestroy" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="40"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="50"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_trapWoodTrigger" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="30"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="40"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_soundGiggle" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="20"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="30"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="zombiefemalescoutattack" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="5"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="20"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_soundBloodmoon" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GTE" value="0"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="5"/>
				</triggered_effect>
			</effect_group>
			<effect_group>
			<!-- outdoor hallucinations -->
				<requirement name="!IsIndoors"/>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="vulturealert" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="40"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="50"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="wolfdiresense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="30"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="40"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bearsense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="20"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="30"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="mlionsense" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GT" value="10"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="20"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_bicycle_horn" play_in_head="true">
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="GTE" value="0"/>
					<requirement name="CVarCompare" cvar=".bb7doiDeprivation2SFXroll" operation="LTE" value="10"/>
				</triggered_effect>
			</effect_group>
		</buff>
		
			<!-- Deprivation visual FX (microsleep / stronger hallucination) -->
		<buff name="bb7doi_buffDeprivationVFX" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="3"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiBaseVFXon" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiMicrosleepVFXon" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiHallucinationVFXon" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ShakeCamera" shake_speed="0" shake_amplitude="0" shake_time="1200"/>
			</effect_group>
			<effect_group>
				<!-- struggling to keep eyes open -->
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<requirement name="!HasBuff" buff="buffMegaCrush"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiDeprivationVFXroll" operation="set" value="randomint(0,100)"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="1" effect_name="Dark"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="1" effect_name="Blur"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="0.2" fade="1" effect_name="FadeToBlack"/>				
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Stunned" enabled="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="ShakeCamera" shake_speed="0.04" shake_amplitude="240" shake_time="1200"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiBaseVFXon" operation="set" value="1"/>
			</effect_group>
			<effect_group>
				<!-- microsleep -->
				<requirement name="!HasBuff" buff="bb7doi_buffAlertness"/>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<requirement name="!HasBuff" buff="buffMegaCrush"/>
				<requirement name="!HasBuff" buff="buffBlackStrapCoffee"/>
				<requirement name="!HasBuff" buff="buffCoffee"/>
				<requirement name="CVarCompare" cvar=".bb7doiDeprivationVFXroll" operation="LTE" value="25"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="1" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Deafened" enabled="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiMicrosleepVFXon" operation="set" value="1"/>
			</effect_group>
			<effect_group>
				<!-- if player was NOT drunk when microsleep triggered, start drunk effect -->
				<requirement name="CVarCompare" cvar=".bb7doiMicrosleepVFXon" operation="Equals" value="1"/>
				<requirement name="ProgressionLevel" progression_name="perkBarBrawling7BoozedUp" operation="Equals" value="0"/>
				<requirement name="!HasBuff" buff="buffBeer"/>
				<requirement name="!HasBuff" buff="buffDrunkGrandpasMoonshine"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".5" fade="1" effect_name="Drunk"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Drunk"/>
			</effect_group>
			<effect_group>
				<!-- if player WAS drunk but had boozed up perk when microsleep triggered, start drunk effect -->
				<requirement name="CVarCompare" cvar=".bb7doiMicrosleepVFXon" operation="Equals" value="1"/>
				<requirement name="ProgressionLevel" progression_name="perkBarBrawling7BoozedUp" operation="GT" value="0"/>
				<requirement name="!HasBuff" buff="buffDrunkGrandpasMoonshine"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".5" fade="1" effect_name="Drunk"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1" effect_name="Drunk"/>
			</effect_group>
			<effect_group>
				<!-- hallucination -->
				<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
				<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="3" effect_name="Trippy"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="3" effect_name="Greyscale"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiHallucinationVFXon" operation="set" value="1"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiBaseVFXon" operation="Equals" value="1"/>
				<requirement name="!HasBuff" buff="bb7doi_buffS1"/>
				<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffRemove" action="SetAudioMixerState" state="Deafened" enabled="false"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".1" effect_name="FadeToBlack"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiBaseVFXon" operation="Equals" value="1"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="2" effect_name="Dark"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="2" effect_name="Blur"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="2" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfBuffRemove" action="SetAudioMixerState" state="Stunned" enabled="false"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiHallucinationVFXon" operation="Equals" value="1"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity=".1" fade="5" effect_name="Trippy"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity=".2" fade="5" effect_name="Greyscale"/>
			</effect_group>
		</buff>
		
	<!-- ###################################################################################################
			Wakefulness debuff:
			- makes it harder to fall asleep the more the player has already slept in a given day
			- measure #1 against abuse of the sleep system, plus it's (somewhat) realistic!
			- partially circumvented with painkillers or alcohol (seems fair since you are using items anyway)
		 ################################################################################################### -->
		<buff name="bb7doi_buffWakefulness" name_key="Refreshed" description_key="RefreshedDesc" icon="ui_game_symbol_map_bed" icon_color="150,255,150" remove_on_death="true"> <!--showonhud="false"-->
			<stack_type value="replace"/>
			<duration value="0"/> <!-- 16 ingame hours -->
			<display_value value="$bb7doiWakefulness"/>
			<display_value_key value="+{0}s"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiWakefulnessCounter" operation="set" value="@$bb7doi16hoursAdjusted"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiWakefulnessCounter" operation="add" value="-1">
					<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$bb7doiWakefulnessCounter" operation="set" value="@$bb7doi16hoursAdjusted">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulnessCounter" operation="LT" value="@$bb7doi16hoursAdjusted"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="subtract" value="@$bb7doiWakefulness"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiWakefulness" operation="set" value="0"/>
				<passive_effect name="PlayerExpGain" operation="perc_add" value=".05"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar="$bb7doiWakefulnessCounter" operation="LTE" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffWakefulness"/>
			</effect_group>
		</buff>
		
	<!-- ###################################################################################################
			Alertness debuff (adrenaline factor):
			Triggers when hurt and makes it impossible to fall asleep for 75 seconds (30 ingame minutes)
		 ################################################################################################### -->
		<buff name="bb7doi_buffAlertness" name_key="Alertness" description_key="AlertnessDesc" icon="ui_game_symbol_quest" icon_color="255,255,150" remove_on_death="true" hidden="true">
			<stack_type value="replace"/>
			<duration value="0"/> <!-- 30 ingame minutes -->
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiAlertnessCounter" operation="set" value="75"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiAlertnessCounter" operation="add" value="-1"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$bb7doiAlertnessCounter" operation="set" value="75">
					<requirement name="CVarCompare" cvar="$bb7doiAlertnessCounter" operation="LT" value="75"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffAlertnessHUD"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiMicrosleepVFXon" operation="Equals" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="0" fade="0" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Deafened" enabled="false"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar="$bb7doiAlertnessCounter" operation="LTE" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffAlertness"/>
			</effect_group>
		</buff>
		<buff name="bb7doi_buffAlertnessHUD" name_key="Alertness" description_key="AlertnessDesc" tooltip_key="AlertnessTooltip" icon="ui_game_symbol_quest" icon_color="255,255,150" remove_on_death="true"  showonhud="true" icon_blink="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
			<display_value value="$bb7doiAlertnessCounter"/>
			<display_value_format value="time"/>
		</buff>
	
	<!-- ###################################################################################################
			Insomnia debuff:
			- Chance to trigger at the end of sleep stage 1 (see that stage for rules)
			- Makes it impossible to fall asleep for an ingame day (1 hour)
		 ################################################################################################### -->
		<buff name="bb7doi_buffInsomnia" name_key="Insomnia" description_key="InsomniaDesc" tooltip_key="InsomniaTooltip" icon="ui_game_symbol_fatigued" icon_color="170,100,100" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/> <!-- an ingame day -->
			<display_value value="$bb7doiInsomniaCounter"/>
			<display_value_format value="time"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInsomniaCounter" operation="set" value="@$bb7doi1dayAdjusted"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaCounter" operation="add" value="-1">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaCounter" operation="GT" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffInsomnia">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaCounter" operation="LTE" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiInsomniaCounter" operation="set" value="0">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaCounter" operation="NotEquals" value="0"/>
				</triggered_effect>
			</effect_group>
		</buff>
	
	<!-- ###################################################################################################
			Insomnia chance tracker (v1.1.0.0)
			- Meant to display information to players to help them figure out how to avoid insomnia
			- Chance calculations largely moved from the sleep buff to these ones
		 ################################################################################################### -->
		<buff name="bb7doi_buffInsomniaChanceTracker" name_key="InsomniaChanceTracker" description_key="InsomniaChanceTrackerDesc" icon="ui_game_symbol_fatigued" icon_color="255,255,255" remove_on_death="true" showonhud="false">
			<stack_type value="replace"/>
			<duration value="0"/>
			<display_value value="$bb7doiInsomniaChance"/>
			<display_value_key value="{0:0.#}%"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceMod" operation="set" value="@$bb7doiLTInsomniaChance"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceMod" operation="add" value="@$bb7doiSTInsomniaChance"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceMod" operation="set" value="90">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaChanceMod" operation="GT" value="90"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceMod" operation="subtract" value="@$bb7doiInsomniaChance"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChance" operation="add" value="@$bb7doiInsomniaChanceMod"/>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar="$bb7doiInsomniaChanceMod" operation="GT" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceModSum" operation="add" value="@$bb7doiInsomniaChanceMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffInsomniaChanceHUD"/>
			</effect_group>
		</buff>
		<buff name="bb7doi_buffInsomniaChanceHUD" name_key="InsomniaChanceHUD" description_key="InsomniaChanceHUDDesc" icon="ui_game_symbol_fatigued" icon_color="255,255,255" remove_on_death="true" showonhud="true">
			<stack_type value="replace"/>
			<duration value="0"/>
			<display_value value="$bb7doiInsomniaChanceModSum"/>
			<display_value_key value="+{0}%"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInsomniaChanceHUDCounter" operation="set" value="6"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInsomniaChanceHUDCounter" operation="add" value="-1"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$bb7doiInsomniaChanceHUDCounter" operation="set" value="6">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaChanceHUDCounter" operation="LT" value="6"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffInsomniaChanceHUD">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaChanceHUDCounter" operation="LTE" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiInsomniaChanceModSum" operation="set" value="0"/>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bb7doi_buffInsomniaChanceHUD">
					<requirement name="CVarCompare" cvar="$bb7doiInsomniaChanceHUDCounter" operation="GT" value="3"/>
				</passive_effect>
			</effect_group>
		</buff>
	
	<!-- ###################################################################################################
			Stimulant buff:
			- Negates effects of sleep deprivation and increases stamina
			- Does not reset sleep deprivation counter so characters still need to sleep afterwards.
			- Disallows sleep for its duration (like insomnia) and increases insomnia chance by 10/2
			- Negates Sedative effects (if one & !theOther)
		 ################################################################################################### -->
		<buff name="bb7doi_buffStimulant" name_key="Stimulants" description_key="StimulantsDesc" tooltip_key="StimulantsTooltip" icon="ui_game_symbol_pills" icon_color="181,121,84" remove_on_death="true">
			<stack_type value="replace"/>
			<duration value="0"/> <!-- 4 ingame hours = 600 -->
			<display_value value=".bb7doiStimulantDisplay"/>
			<display_value_format value="time"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffStimulantON">
					<requirement name="!HasBuff" buff="bb7doi_buffSedative"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="add" value="20"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="add" value="4"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiStimulantDuration" operation="subtract" value="@$MetabolismDuration"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiStimulantDisplay" operation="set" value="@$bb7doiStimulantDuration"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiStimulantDisplay" operation="divide" value="@$MetabolismDuration"/>
				<passive_effect name="StaminaChangeOT" operation="perc_add" value="0.25"> <!-- buffBlackStrapCoffee -->
					<requirement name="!HasBuff" buff="buffHealWaterMax"/>
				</passive_effect>
				<passive_effect name="StaminaChangeOT" operation="perc_add" value="0.1"> <!-- buffCoffee -->
					<requirement name="HasBuff" buff="buffHealWaterMax"/>
				</passive_effect>
				<passive_effect name="WaterChangeOT" operation="base_subtract" value="0.2"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffStimulant">
					<requirement name="CVarCompare" cvar="$bb7doiStimulantDuration" operation="LTE" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveCVar" cvar=".bb7doiStimulantDisplay,$bb7doiStimulantDuration"/>
			</effect_group>
		</buff>
	
	<!-- ###################################################################################################
			Sedative buff:
			- Removes insomnia (but not insomnia chance)
			- Makes character drowsy (Deprivation visual FX)
			- Character falls asleep faster
			- Negates Stimulant effects (if one & !theOther)
		 ################################################################################################### -->
		<buff name="bb7doi_buffSedative" name_key="Sedatives" description_key="SedativesDesc" tooltip_key="SedativesTooltip" icon="ui_game_symbol_pills" icon_color="160,188,202" remove_on_death="true">
			<stack_type value="replace"/>
			<duration value="0"/> <!-- 3 ingame hours = 400 -->
			<display_value value=".bb7doiSedativeDisplay"/>
			<display_value_format value="time"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffStimulantON"/>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffInsomnia"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiSedativeDuration" operation="subtract" value="@$MetabolismDuration"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiSedativeDisplay" operation="set" value="@$bb7doiSedativeDuration"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiSedativeDisplay" operation="divide" value="@$MetabolismDuration"/>
				<passive_effect name="WaterChangeOT" operation="base_subtract" value="0.2"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffSedative">
					<requirement name="CVarCompare" cvar="$bb7doiSedativeDuration" operation="LTE" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="bb7doi_buffStimulantON">
					<requirement name="HasBuff" buff="bb7doi_buffStimulant"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiSedativeDuration" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".bb7doiSedativeDisplay" operation="set" value="0"/>
			</effect_group>
		</buff>		
		<buff name="bb7doi_buffSedative2Blinking" hidden="true">
			<stack_type value="ignore"/>
			<duration value="3"/>
			<effect_group>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bb7doi_buffSedative"/>
			</effect_group>
		</buff>

	<!-- ###################################################################################################
			+Stimulant AND -Sedative check buff (to make other checks simpler and more consistent)
			- It's OFF when either Sedative is ON or Stimulant is OFF (Stimulant is not working either way)
			- It's ON when both Sedative is OFF and Stimulant is ON (the only way Stimulant can work)
		 ################################################################################################### -->
		<buff name="bb7doi_buffStimulantON"  remove_on_death="true" hidden="true">
			<stack_type value="replace"/>
			<duration value="0"/>
			<effect_group>
				<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
				<requirement name="!HasBuff" buff="bb7doi_buffDeprivationVFX"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="0" fade=".1" effect_name="Trippy"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity=".1" fade="60" effect_name="Trippy"/>
			</effect_group>
		</buff>
		 
	<!-- ###################################################################################################
			Stage 0: 
			- player must crouch on a bed or bedroll in order to start trying to sleep
			- makes the player warmer too
		 ################################################################################################### -->
		<buff name="bb7doi_buffS0" hidden="true" remove_on_death="true">
			<stack_type value="duration"/>
			<duration value="5"/>
			<effect_group>
				<!-- reset vars used for healing -->
				<requirement name="!HasBuff" buff="bb7doi_buffS0Quality"/>
				<!-- <requirement name="CVarCompare" cvar="$bb7doiIsUnhealthy" operation="Equals" value="1"/> -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiHealthModMax" operation="set" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiHealthModStep" operation="set" value=".017"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFatigueModMax" operation="set" value="-40"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFatigueModStep" operation="set" value="-0.6"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionModMax" operation="set" value="-20"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionModStep" operation="set" value="-0.3"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiOtherModMax" operation="set" value="-40"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiOtherModStep" operation="set" value="-0.6"/>
			</effect_group>
			<effect_group>
				<requirement name="HasBuff" buff="bb7doi_buffInsomnia"/>
				<passive_effect name="BuffBlink" operation="base_set" value="2" tags="bb7doi_buffInsomnia"/>
				<triggered_effect trigger="onSelfCrouch" action="ShowToolbeltMessage" message_key="SleepS0Insomnia"/>
			</effect_group>
			<effect_group>
				<requirement name="HasBuff" buff="bb7doi_buffStimulantON"/>
				<passive_effect name="BuffBlink" operation="base_set" value="2" tags="bb7doi_buffStimulant"/>
				<triggered_effect trigger="onSelfCrouch" action="ShowToolbeltMessage" message_key="SleepS0Stimulants"/>
			</effect_group>
			<effect_group>
				<!-- getting in bed makes you warmer -->
				<passive_effect name="HypothermalResist" operation="base_add" value="10">
					<requirement name="CVarCompare" cvar="_crouching" operation="Equals" value="1"/>
				</passive_effect>
				<triggered_effect trigger="onSelfCrouch" action="AddBuff" buff="bb7doi_buffS1">
					<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
					<requirement name="!HasBuff" buff="bb7doi_buffInsomnia"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS1"/>
					<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffS0Quality"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bb7doi_buffDummyBedtime"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffDummyBedtime"/>
			</effect_group>
		</buff>
		
		<!-- buff applied when sleeping on a comfy bed -->
		<buff name="bb7doi_buffS0Quality" hidden="true" remove_on_death="true">
			<stack_type value="duration"/>
			<duration value="5"/>
			<effect_group>
				<requirement name="!HasBuff" buff="bb7doi_buffS0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiHealthModMax" operation="set" value="1.5"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiHealthModStep" operation="set" value=".025"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFatigueModMax" operation="set" value="-60"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFatigueModStep" operation="set" value="-1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionModMax" operation="set" value="-30"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionModStep" operation="set" value="-0.5"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiOtherModMax" operation="set" value="-60"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiOtherModStep" operation="set" value="-1"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffS0"/>
			</effect_group>
		</buff>
				
		<!-- buff used for challenges -->
		<buff name="bb7doi_buffDummyBedtime" name_key="YourIgnorance" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
		</buff>
		
	<!-- ###################################################################################################
			Stage 1: Trying to sleep
				These factors affect how fast a character falls asleep:
				- 20-30 seconds minimum (8-12 ingame minutes)
				- Getting hurt cancels it
				- Diarrhea cancels it (pain/discomfort)
				- Coffee makes it harder to fall asleep
				- Fatigue helps
				- Digestion helps - actually it *can* make sleep harder, so I'm removing this one.
				- Painkillers help
				- Alcohol helps initially, but can disrupt sleep (insomnia)
				- Falling asleep once a day is easy, more not so much (sleep/stress hormones buildup)
				- Outdoors makes it harder (anxiety)
				- Hunger/thirst makes it harder (discomfort) 
				- Too hot or too cold makes it harder (discomfort)
				- Bed quality (discomfort)
				- Whether it's nighttime or not (circadian rhythm)
				- Randomness (representing a myriad of other minor factors)
				
			Insomnia system:
				- 1 roll every time the character is about to fall asleep
				- base chance = 0. Increases in multiple ways
				- chance only lowers upon waking up naturally
				- effects that affect chance are divided into two groups: short-term and long-term
				- chance from short-term effects resets to 0 the next time the player wakes up naturally
				- chance from long-term effects gets multiplied by 0.5 every time the player wakes up naturally
				- the sum of short-term + long-term chance is the total chance
				- chance can never be > 90%
			
										STE		LTE
				deprivation1			0		10
				deprivation2			0		20
				coffee					6		0
				Mega Crush				8		0	
				alcohol	(once/day)		20		0
				stimulant				20		4
				jumpscare				0		40
		################################################################################################### -->	
		<buff name="bb7doi_buffS1" name_key="SleepS1" description_key="SleepS1Desc" tooltip_key="SleepS1Tooltip" icon="ui_game_symbol_map_bed" remove_on_death="true">
			<stack_type value="duration"/>
			<duration value="0"/>
			<display_value_key value="SheepCounter"/>
			<display_value value="$bb7doiIncWaitCounter"/>
			<effect_group>
				<!-- blink all buffs affecting how fast the player falls asleep -->
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffAlertnessHUD">
					<requirement name="HasBuff" buff="bb7doi_buffAlertness"/>
				</triggered_effect>
				<passive_effect name="BuffBlink" operation="base_set" value="2" tags="bb7doi_buffWakefulness,bb7doi_buffSedative,buffCoffee,buffBlackStrapCoffee,buffMegaCrush,buffStatusHungry02,buffStatusThirsty02,buffBeer,buffDrunkGrandpasMoonshine,buffDrunkGrandpasAwesomeSauce,buffDrunkGrandpasLearningElixir,buffDrugPainkillers,buffDrugFortBites"/>
				<!-- <passive_effect name="BuffBlink" operation="base_set" value="2" tags="buffHealFood"/> -->	<!-- digestion -->
				
				<!-- reset vars -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiHealthMod" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFatigueMod" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionMod" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiOtherMod" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiFoodWaterCost" operation="set" value="-.1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiIncWaitCounter" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInsomniaTriggered" operation="set" value="0"/>
				
				<!-- character closes eyes -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" intensity="1" fade="2" effect_name="FadeToBlack"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="2" effect_name="FadeToBlack"/> -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" intensity="1" fade="3" effect_name="Blur"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="3" effect_name="Blur"/> -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" intensity=".2" fade="3" effect_name="Drunk"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".2" fade="3" effect_name="Drunk"/> -->
								
				<!-- decide time needed to fall asleep based on factors -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="set" value="randomint(20,30)"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.5">
					<requirement name="HasBuff" buff="buffStatusHungry02"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.5">
					<requirement name="HasBuff" buff="buffStatusThirsty02"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.25">
					<requirement name="HasBuff" buff="buffElementSweltering"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.25">
					<requirement name="HasBuff" buff="buffElementFreezing"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.2">
					<requirement name="HasBuff" buff="buffStatusHungry01"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.2">
					<requirement name="HasBuff" buff="buffStatusThirsty01"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.1">
					<requirement name="!IsIndoors"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.1">
					<requirement name="HasBuff" buff="buffElementHot"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.1">
					<requirement name="HasBuff" buff="buffElementCold"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="1.1">
					<requirement name="IsDay"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="0.9">
					<requirement name="HasBuff" buff="bb7doi_buffS0Quality"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="add" value="@$bb7doiWakefulness">
					<requirement name="HasBuff" buff="bb7doi_buffWakefulness"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".5">
					<requirement name="CVarCompare" cvar="$fatiguedCounter" operation="GT" value="0"/>
				</triggered_effect>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".9"> -->
					<!-- <requirement name="HasBuff" buff="buffHealFood"/> -->
				<!-- </triggered_effect> -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="2">
					<requirement name="HasBuff" buff="buffCoffee"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="2">
					<requirement name="HasBuff" buff="buffBlackStrapCoffee"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value="2">
					<requirement name="HasBuff" buff="buffMegaCrush"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".75">
					<requirement name="HasBuff" buff="buffBeer"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".5">
					<requirement name="HasBuff" buff="buffDrunkGrandpasMoonshine"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".5">
					<requirement name="HasBuff" buff="buffDrunkGrandpasAwesomeSauce"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".5">
					<requirement name="HasBuff" buff="buffDrunkGrandpasLearningElixir"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".9">
					<requirement name="HasBuff" buff="buffDrugPainkillers"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".75">
					<requirement name="HasBuff" buff="buffDrugFortBites"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".5">
					<requirement name="HasBuff" buff="bb7doi_buffBedtime"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".4">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".3">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="multiply" value=".2">
					<requirement name="HasBuff" buff="bb7doi_buffSedative"/>
					<requirement name="!HasBuff" buff="bb7doi_buffStimulant"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<requirements compare_type="or">
					<requirement name="HasBuff" buff="buffBeer"/>
					<requirement name="HasBuff" buff="buffDrunkGrandpasMoonshine"/>
					<requirement name="HasBuff" buff="buffDrunkGrandpasAwesomeSauce"/>
					<requirement name="HasBuff" buff="buffDrunkGrandpasLearningElixir"/>
				</requirements>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDrunkSleepBool" operation="set" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="add" value="20"/>
			</effect_group>
			
			<effect_group>
				<!-- insomnia check -->
				<requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="@$bb7doiInsomniaChance"/>
				<requirement name="!HasBuff" buff="bb7doi_buffSedative"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInsomniaTriggered" operation="set" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="set" value="randomint(3,6)"/>
			</effect_group>
			
			<effect_group>
				<!-- wait the minimum necessary time -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiMinWaitCounter" operation="add" value="-1">
					<requirement name="CVarCompare" cvar="$bb7doiMinWaitCounter" operation="GT" value="0"/>
					<requirement name="!HasBuff" buff="bb7doi_buffAlertness"/>
					<requirement name="!HasBuff" buff="bb7doi_buffInsomnia"/>
					<requirement name="!HasBuff" buff="bb7doi_buffStimulantON"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- displayed counter -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiIncWaitCounter" operation="add" value="1"/>
			</effect_group>
			
			<effect_group>
				<!-- insomnia triggered -->
				<requirement name="CVarCompare" cvar="$bb7doiInsomniaTriggered" operation="Equals" value="1"/>
				<requirement name="CVarCompare" cvar="$bb7doiMinWaitCounter" operation="LTE" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffInsomnia"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS1"/>
			</effect_group>
					
			<effect_group>
				<!-- fall asleep -->
				<requirement name="CVarCompare" cvar="$bb7doiMinWaitCounter" operation="LTE" value="0"/>
				<requirement name="!HasBuff" buff="bb7doi_buffInsomnia"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS1"/>
			</effect_group>
			
			<effect_group>
				<!-- cancelling conditions -->
				<triggered_effect trigger="onSelfStand" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfRun" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfWalk" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfCrouchRun" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfCrouchWalk" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfFallImpact" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<triggered_effect trigger="onSelfTeleported" action="RemoveBuff" buff="bb7doi_buffS1"/>
				<!-- restore short term insomnia chance if the alcohol bonus was applied before and the sleep attempt was then canceled -->
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="add" value="-20">
					<requirement name="CVarCompare" cvar="$bb7doiDrunkSleepBool" operation="Equals" value="1"/>
					<requirement name="CVarCompare" cvar="$bb7doiMinWaitCounter" operation="GT" value="0"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiDrunkSleepBool" operation="set" value="0"/>
			</effect_group>
			
			<effect_group>
				<requirement name="!HasBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".4" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".8" effect_name="Drunk"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1.6" effect_name="Blur"/>
			</effect_group>
		</buff>
		
	<!-- ##################################################################################
			Stage 2: Sleeping
			- player can't walk/run or wake up on their own
			- hearing is impaired (you're unconscious, duh!)
			- heals (over time) up to 20% Infection
			- up to 100% HP and 100% Fatigued status
			- up to 30% of other injuries/diseases
			- healing injuries or diseases costs a little hunger/thirst
			- healing rate increases the longer you stay in bed, up to a maximum
			
		 ################################################################################## -->
		<!-- snoring sound - attracts zombies -->
		<buff name="bb7doi_buffSnoring" hidden="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="5"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiSnoreCount" operation="add" value="-1"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_soundSnore" play_at_self="true"/>
			</effect_group>
		</buff>
		
		<buff name="bb7doi_buffS2" name_key="SleepS2" description_key="SleepS2Desc" tooltip_key="SleepS2Tooltip" icon="ui_game_symbol_natural_healing" icon_color="256,210,210" icon_blink="true" remove_on_death="true">
			<stack_type value="ignore"/>
			<duration value="0"/>
			<display_value value="$bb7doiWakefulness"/>
			<display_value_key value="Zzz {0}s"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bb7doi_buffDummy7daysAwake"/>
				<!-- Sleep start: sound effects & paralysis -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".bb7doiSandmanChance" operation="set" value="2"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bb7doi_soundMrSandman" play_at_self="true">
					<requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="@.bb7doiSandmanChance"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity="1" fade="2" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity="1" fade="2" effect_name="Blur"/>
				<triggered_effect trigger="onSelfEnteredGame" action="ModifyScreenEffect" intensity=".2" fade="2" effect_name="Drunk"/>
				<triggered_effect trigger="onSelfEnteredGame" action="SetAudioMixerState" state="Deafened" enabled="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Deafened" enabled="true"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="Ragdoll" duration="999"/> -->
				<passive_effect name="Mobility" operation="perc_add" value="-2.0"/>
				<passive_effect name="JumpStrength" operation="perc_subtract" value="2.00"/>
				<passive_effect name="EntityDamage" operation="perc_subtract" value="3.0"/>
				<passive_effect name="BlockDamage" operation="perc_subtract" value="3.0"/> 
				<passive_effect name="WeaponHandling" operation="perc_add" value="-0.5"/>
				<passive_effect name="ReloadSpeedMultiplier" operation="perc_add" value="-0.3"/>
				<passive_effect name="AttacksPerMinute" operation="perc_add" value="-0.3"/>
				<passive_effect name="RoundsPerMinute" operation="perc_add" value="-0.9"/>
				<!-- Set variables -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinSleep" operation="set" value="20"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinSleep" operation="add" value="@$bb7doiWakefulness"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinSleep" operation="add" value="20">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMinSleep" operation="add" value="40">
					<requirement name="HasBuff" buff="bb7doi_buffDeprivation2"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMaxSleep" operation="set" value="@$bb7doiWakefulness"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMaxSleep" operation="add" value="80"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiMaxSleep" operation="add" value="randomint(0,20)"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDysenteryFloor" operation="set" value="@$dysenteryCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiDysenteryFloor" operation="multiply" value=".7"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionFloor" operation="set" value="@infectionCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiInfectionFloor" operation="multiply" value=".8"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiAbrasionFloor" operation="set" value="@$abrasionCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiAbrasionFloor" operation="multiply" value=".7"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiConcussionFloor" operation="set" value="@$concussionCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiConcussionFloor" operation="multiply" value=".7"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLegHurtFloor" operation="set" value="@$legHurtCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLegHurtFloor" operation="multiply" value=".7"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiArmHurtFloor" operation="set" value="@$armHurtCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiArmHurtFloor" operation="multiply" value=".7"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLacerationFloor" operation="set" value="@$lacerationCounter"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLacerationFloor" operation="multiply" value=".7"/>
			</effect_group>
			
			<effect_group>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".bb7doiSnoreCount" operation="set" value="randomint(1,4)">
					<requirement name="RandomRoll" seed_type="Random" min_max="0,1000" operation="LTE" value="38"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffSnoring">
					<requirement name="CVarCompare" cvar=".bb7doiSnoreCount" operation="GT" value="0"/>
					<requirement name="!HasBuff" buff="bb7doi_buffSnoring"/>
				</triggered_effect>
				<!-- update vars -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiWakefulness" operation="add" value="1"/>
					<!-- <requirement name="CVarCompare" cvar="$bb7doiTrackerCounter" operation="LTE" value="0"/> -->
				<!-- </triggered_effect> -->
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealthMod" operation="add" value="@$bb7doiHealthModStep">
					<requirement name="CVarCompare" cvar="$bb7doiHealthMod" operation="LT" value="@$bb7doiHealthModMax"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiFatigueMod" operation="add" value="@$bb7doiFatigueModStep">
					<requirement name="CVarCompare" cvar="$bb7doiFatigueModMax" operation="LT" value="@$bb7doiFatigueMod"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiInfectionMod" operation="add" value="@$bb7doiInfectionModStep">
					<requirement name="CVarCompare" cvar="$bb7doiInfectionModMax" operation="LT" value="@$bb7doiInfectionMod"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiOtherMod" operation="add" value="@$bb7doiOtherModStep">
					<requirement name="CVarCompare" cvar="$bb7doiOtherModMax" operation="LT" value="@$bb7doiOtherMod"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- HP recovery -->
				<requirement name="CVarCompare" cvar=".NoHealingManager" operation="Equals" value="0"/>
				<requirement name="StatComparePercCurrentToModMax" stat="health" operation="LT" value=".985"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Health" operation="add" value="@$bb7doiHealthMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- fatigue recovery -->
				<requirement name="CVarCompare" cvar="$fatiguedCounter" operation="GT" value="0"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$fatiguedCounter" operation="add" value="@$bb7doiFatigueMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- abrasion recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$abrasionCounter" operation="GT" value="@$bb7doiAbrasionFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$abrasionCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- concussion recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$concussionCounter" operation="GT" value="@$bb7doiConcussionFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$concussionCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- dysentery recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$dysenteryCounter" operation="GT" value="@$bb7doiDysenteryFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$dysenteryCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- infection recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="infectionCounter" operation="GT" value="@$bb7doiInfectionFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="infectionCounter" operation="add" value="@$bb7doiInfectionMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- laceration recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$lacerationCounter" operation="GT" value="@$bb7doiLacerationFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$lacerationCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- sprained/broken leg recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$legHurtCounter" operation="GT" value="@$bb7doiLegHurtFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$legHurtCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<effect_group>
				<!-- sprained/broken arm recovery - costs hunger & thirst -->
				<requirement name="CVarCompare" cvar="$armHurtCounter" operation="GT" value="@$bb7doiArmHurtFloor"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$armHurtCounter" operation="add" value="@$bb7doiOtherMod"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Food" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyStats" stat="Water" operation="add" value="@$bb7doiFoodWaterCost"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bb7doiHealingBool" operation="set" value="1">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="LT" value="@$bb7doiMaxSleep"/>
				</triggered_effect>
			</effect_group>
			
			<!-- sleep-ending conditions -->
			<effect_group>
				<!-- Wake up naturally when done healing up -->
				<requirement name="CVarCompare" cvar="$bb7doiHealingBool" operation="Equals" value="0"/>
				<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="GTE" value="@$bb7doiMinSleep"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffTracker"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="multiply" value=".5"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="set" value="0">
					<requirement name="CVarCompare" cvar="$bb7doiLTInsomniaChance" operation="LT" value="1"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="set" value="0"/>
			</effect_group>
			
			<effect_group>
				<!-- wake up due to starvation -->
				<requirement name="HasBuff" buff="buffStatusHungry03"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS2"/>	
				<triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message_key="SleepS2Hungry"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="Player$Hungry" play_in_head="true"/> -->
			</effect_group>
			
			<effect_group>
				<!-- wake up due to dehydration -->
				<requirement name="HasBuff" buff="buffStatusThirsty03"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS2"/>	
				<triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message_key="SleepS2Thirsty"/>
				<!-- <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="Player$Thirsty" play_in_head="true"/> -->
				
			</effect_group>
			
			<effect_group>
				<!-- silently wake up due to being attacked or other reasons -->
				<triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".bb7doiJumpscare" operation="set" value="1"/>
				<triggered_effect trigger="onOtherDamagedSelf" action="RemoveBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onOtherDamagedSelf" action="ShakeCamera" shake_speed="8" shake_amplitude="240" shake_time=".3"/>
				<triggered_effect trigger="onSelfFallImpact" action="RemoveBuff" buff="bb7doi_buffS2"/>
				<triggered_effect trigger="onSelfTeleported" action="RemoveBuff" buff="bb7doi_buffS2"/>
			</effect_group>
			
			<!-- <effect_group> -->
				<!-- 20% chance to wake up when combat starts... whatever that means -->
				<!-- not working? not surprised -->
				<!-- <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="GTE" value="20"/> -->
				<!-- <triggered_effect trigger="onCombatEntered" action="RemoveBuff" buff="bb7doi_buffS2"/> -->
				<!-- <triggered_effect trigger="onCombatEntered" action="ShowToolbeltMessage" message="!!!"/> -->
			<!-- </effect_group> -->
			
			<effect_group>
				<!-- remove effects when the character wakes up -->
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bb7doi_buffSnoring">
					<requirement name="HasBuff" buff="bb7doi_buffSnoring"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="SetAudioMixerState" state="Deafened" enabled="false"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".4" effect_name="FadeToBlack"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".8" effect_name="Drunk"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="1.6" effect_name="Blur"/>
				<!-- add debuffs -->
				<triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="bb7doi_buffWakefulness">
					<requirement name="CVarCompare" cvar="$bb7doiWakefulness" operation="GT" value="0"/>
					<requirement name="!HasBuff" buff="bb7doi_buffDeprivation"/>
					<requirement name="!HasBuff" buff="bb7doi_buffDeprivation2"/>
				</triggered_effect>
			</effect_group>
			<effect_group>
				<requirement name="CVarCompare" cvar=".bb7doiJumpscare" operation="GT" value="0"/>
				<triggered_effect trigger="onSelfBuffRemove" action="PlaySound" sound="bb7doi_soundJumpscare" play_in_head="true"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar=".bb7doiJumpscare" operation="set" value="0"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="add" value="40"/>
			</effect_group>
		</buff>
	</append>
	
	<!-- Diarrhea wakes up characters if they are sleeping or falling asleep -->
	<insertAfter xpath="//triggered_effect[@sound='player#sick']">
		<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS1"/>
		<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bb7doi_buffS2"/>
	</insertAfter>
	
	<append xpath="/buffs/buff[@name='buffStatusCheck01']">
		<effect_group>
			<!-- Getting attacked alerts characters -->
			<triggered_effect trigger="onOtherDamagedSelf" action="AddBuff" buff="bb7doi_buffAlertness"/>
			<triggered_effect trigger="onOtherAttackedSelf" action="AddBuff" buff="bb7doi_buffAlertness"/>
			<triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="bb7doi_buffTracker">
				<requirement name="!HasBuff" buff="bb7doi_buffTracker"/>
			</triggered_effect>
		</effect_group>
	</append>
	
	<!-- Coffee increases chance of insomnia slightly -->
	<append xpath="/buffs/buff[@name='buffCoffee' or @name='buffBlackStrapCoffee']">
		<effect_group>
			<!-- <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiLTInsomniaChance" operation="add" value="2"/> -->
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="add" value="6"/>
		</effect_group>
	</append>
	<!-- Mega Crush increases chance of insomnia slightly -->
	<append xpath="/buffs/buff[@name='buffMegaCrush']">
		<effect_group>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bb7doiSTInsomniaChance" operation="add" value="8"/>
		</effect_group>
	</append>
	
</Byteblazar>
